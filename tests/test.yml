---
- hosts: all

  vars:
    nginx_use_ppa: true

  roles:
    - role_under_test

  tasks:

    - name: Check if InfluxDB is listening to network ports.
      wait_for:
        port: "{{ item }}"
        delay: 300
      with_items:
        - 8083
        - 8086

    - name: Create test database.
      influxdb_database:
        hostname: localhost
        database_name: test_database
        state: present
